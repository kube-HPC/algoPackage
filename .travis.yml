sudo: required
language: node_js
node_js:
- '8'
services:
- docker
- redis
branches:
  only:
  - master
before_install:
- docker run -d --name etcd -p 2380:2380 -p 4001:4001 quay.io/coreos/etcd:latest /usr/local/bin/etcd
  --data-dir=data.etcd --name "my-etcd" --cors='*' --initial-advertise-peer-urls http://0.0.0.0:2380
  --listen-peer-urls http://0.0.0.0:2380 --advertise-client-urls http://0.0.0.0:4001
  --listen-client-urls http://0.0.0.0:4001     --initial-cluster-state new
install:
- npm --registry http://npmhkube.ddns.net:4873 install
cache:
  directories:
  - node_modules
script:
- NODE_ENV=test npm test
after_success:
- git config --global user.email "travis@travis-ci.org"
- git config --global user.name "Travis CI"
- git remote set-url --push origin "https://${GH_TOKEN}@github.com/${TRAVIS_REPO_SLUG}.git"
- git remote -v
- git checkout -b version-branch
- npm version patch -m "$(git log -1 --pretty=%B) .... bump version [skip ci]"
- git push origin version-branch:master --follow-tags
- docker login --username yehiyam --password ${DOCKER_HUB_PASS}
deploy:
  skip_cleanup: true
  provider: script
  script: PRIVATE_REGISTRY=docker.io/hkube npm run build
  on:
    branch: master
env:
  global:
  - secure: IQYCnUVrWn4bfecWKgZwhL6VqI3k9fgP6v9RorbRtZziXPfv48lV4gMrBE0OZmjGp9ay6HfjJnkCeasvk0c0SVi0XuaAKXq6HxkYh0qO3W1thmEom7nYNRR7CWFf6CmX8INFW+Xw5O2hq0QGdKLpuLdVYefPIG6YrXm9EKT4y1+SNc5IAAES/qYAl2z9DDab8/x/YawGu+HAgQ8XZ+SGDer9ZpnJFGOLolQWje+9iF9DzMAYTubTjCZwiO+JUQB2MogzNsZZbw4fCHIXIlkZSHmqQ56g7o8zW7ga341nlFkHdgl0nQeWPLnvXC0s5gmc0Ji2f1As5WNr6GLDvM4GPbW3WEVs3LV/tnz+aiFuhcnDYFyGDW2JNBpxGuYzvnt+xSBzeYmX1cGim2MRz93U16H9p2j4T9zyiPjJEWcNJvcXopcdT9dgRfPvf7P9BIGd9CEAs9xukyDajNoBO4LfLaL09aHvBcPzEwaorl0Z4HyDHcR1qPyq4p0Et5lxfD6mL5AKDn/8DK6527ESkugmrKcpDthXYS2eGluFOMBF6/1aQ4OuLJv/t8ZLAA4lrKoQG7fZrDGosf9SfFJ8zq14VZHicpK43PLCHtoyq3wayntonhM9aqftg16pTWclvfwfAQe+ArLOzvEBmpgKk0xttNUwP8XiTHmSCgIKhnxDr+I=
  - secure: Dx/DKZj0xuvyePGiJF1FPSiGElmhwUOb1et8xuWe24r/q79orRDJ8Rr5Kuu6W/scE3Ti7Sk+3ktxX9ioFU0yT1poT17c1eD03fZfCJ4JHWY6WKPOtFI4hkw7V9v11HRKxbua6jF37cznNJwhr9mVl0E3Y++kqHjulpPzZvMjDvwhooPoAHB/MoGr75v9vz919ZfjExLUB02QLQde2ih0koY3vByMWXG7Gu+BZPcmeD82vjRxRT3ep5Ql+fu7sSIjyu1QbEeWtZxXT+XBUt1Qkwxp0UBKoAtwhr58Arh/M1xcPO08squb6miQ8pq7NXha3q1wB1UJl4NGgNL0vfPF0F/A/BK0bXthE5xnKrlMdxZq/lNXaztCQNvVAXofTRSIi+dVSEoZ3iokXSAU+OuiKdlsgfhVayw/VtPrH2tIeLCAtI59RNp5zSkFuA52whjbM6Rw6ng3gdLaGl47NRK9saBHvNssoZr6c62AAtTgKk8pV9ATQT5Ks6z9PutByLqFfaeAhoIwUJCrb0RD9Y9zq9N1swkad9VKzczSoEi1QNER0aa/MfZUqa6aSIEJrhOYExysFoiwFeOcRofF7agr8gAZguk6yxLeB0eVIwAUQk7q9knkHAu7KgKtx1/6ZBs/Yg2IiB6YecInXT0rGOm3qbz3pASHUEzLJKGRAFYYomo=
